{% set alertsWsAppli = siamu_ws.alertsWsAppli %}
{% set alertsWsAppliSource = siamu_ws.alertsWsAppliSource %}

{% if not siamu_ws.maintenanceModeRequired %}
    {# Si on est pas en mode maintenance (criticité = 3), on affiche quand même les events avec une criticité plus basse #}
    <div class="container-fluid" id="siamu-content">
        {% if alertsWsAppli|length > 0 %}

            {# Boolean si l'évènement est en cours ou pas #}
            {% set current = date(alertsWsAppli[0]['date_debut'])|date('d/m/Y H:i') < "now"|date('d/m/Y H:i') %}

            <div class="alert alert-warning" role="alert">
                {% if current %}{{ "siamu_alert_live"|trans }}{% else %}{{ "siamu_alert_coming"|trans }}{% endif %}<br>
                {% if not current %}
                    {{ "siamu_alert_scheduledStart"|trans }} : {{ alertsWsAppli[0]['date_debut']|date('d/m/Y H:i') }}
                    <br>
                {% endif %}
                {{ "siamu_alert_expectedEnd"|trans }} : {{ alertsWsAppli[0]['date_fin']|date('d/m/Y H:i') }}<br>
                <a class="btn btn-sm btn-danger" data-bs-toggle="collapse" href="#collapse-detail-wsappli" role="button"
                   aria-expanded="false" aria-controls="collapseExample">
                    {{ "siamu_button_details"|trans }}
                </a>
                <div class="collapse" id="collapse-detail-wsappli">
                    {{ alertsWsAppli[0]['description_pub'] }}<br>
                    {{ "siamu_criticity"|trans }} :
                    {% if alertsWsAppli[0]['criticite'] == 1 %}
                        {{ "siamu_criticity_faible"|trans }}
                    {% elseif alertsWsAppli[0]['criticite'] == 2 %}
                        {{ "siamu_criticity_moyenne"|trans }}
                    {% else %}
                        {{ "siamu_criticity_forte"|trans }}
                    {% endif %}
                    <br>
                </div>
            </div>
        {% endif %}

        {% if alertsWsAppliSource|length > 0 %}

            {# Boolean si l'évènement est en cours ou pas #}
            {% set current = date(alertsWsAppliSource[0]['date_debut'])|date('d/m/Y H:i') < "now"|date('d/m/Y H:i') %}

            <div class="alert alert-warning" role="alert">
                {% if current %}
                    {{ "siamu_alert_source_live"|trans }}
                {% else %}
                    {{ "siamu_alert_source_coming"|trans }}
                {% endif %}
                <br>
                {% if not current %}
                    {{ "siamu_alert_scheduledStart"|trans }} : {{ alertsWsAppliSource[0]['date_debut']|date('d/m/Y H:i') }}
                    <br>
                {% endif %}
                {{ "siamu_alert_expectedEnd"|trans }} : {{ alertsWsAppliSource[0]['date_fin']|date('d/m/Y H:i') }}<br>

                <a class="btn btn-sm btn-danger" data-bs-toggle="collapse" href="#collapse-detail-wsapplisource"
                   role="button"
                   aria-expanded="false" aria-controls="collapseExample">
                    {{ "siamu_button_details"|trans }}
                </a>
                <div class="collapse" id="collapse-detail-wsapplisource">
                    {{ "siamu_affected_application"|trans }} : {{ alertsWsAppliSource[0]['nom appli'] }}<br>
                    {{ alertsWsAppliSource[0]['description_pub'] }}<br>

                    {{ "siamu_criticity"|trans }} :
                    {% if alertsWsAppliSource[0]['criticite'] == 1 %}
                        {{ "siamu_criticity_faible"|trans }}
                    {% elseif alertsWsAppliSource[0]['criticite'] == 2 %}
                        {{ "siamu_criticity_moyenne"|trans }}
                    {% else %}
                        {{ "siamu_criticity_forte"|trans }}
                    {% endif %}
                </div>
            </div>
        {% endif %}
    </div>
    {# Sinon c'est qu'on est en maintenance, et si on est dev on a quand même accès à l'application, donc on affiche un message d'information pour le dev. #}
{% elseif is_granted('ROLE_DEVELOPER') %}
    <div class="container-fluid" id="maintenance-dev">
        <div class="alert alert-danger" role="alert">
            <p>
                {{ "siamu_developer_access"|trans }}
            </p>
        </div>
    </div>
{% endif %}
